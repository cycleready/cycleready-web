var cityOutline = {"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-122.5131622190064,37.775050754396915],[-122.51447358997713,37.780598109706986],[-122.51192984628692,37.78431359581951],[-122.5099864893062,37.78471722801558],[-122.50608397569451,37.788173975540886],[-122.49957451979161,37.78870180225882],[-122.49654098694366,37.78728391480084],[-122.49127970341048,37.788267121432284],[-122.48622381533056,37.790512972369385],[-122.48437525625134,37.79272777467602],[-122.4802041485854,37.80142139120672],[-122.47789739964894,37.80843838169222],[-122.47773940314644,37.810932621673054],[-122.47604884056972,37.80963892873694],[-122.47053476263255,37.80858327530107],[-122.4672168360801,37.80601658851581],[-122.46358291652265,37.80487813873203],[-122.45449811762904,37.806461618885834],[-122.44798866172614,37.806968746516795],[-122.44280637644422,37.807796709995905],[-122.4475620711694,37.80638917208141],[-122.44732507641565,37.805312819558566],[-122.44290117434572,37.80671000792957],[-122.43566493453133,37.80725853373448],[-122.43397437195462,37.80642022071188],[-122.43209421357489,37.80721713556053],[-122.42681713039147,37.808107196300575],[-122.42370459929226,37.806658260212124],[-122.42097125979906,37.80895585886667],[-122.41634196227588,37.80826243945291],[-122.42059206819306,37.81125345752121],[-122.41055929028447,37.808821314801314],[-122.409390116166,37.80903865521458],[-122.40281746166208,37.80601658851581],[-122.40041591482412,37.80725853373448],[-122.40096890258286,37.803553397165444],[-122.39724018512392,37.79937218159591],[-122.39412765402471,37.79686759207159],[-122.38934035999904,37.791423732196414],[-122.38742860231882,37.78724251662688],[-122.38455306597336,37.78739775977922],[-122.38437926982061,37.78569008510354],[-122.38739700301832,37.78551414286423],[-122.38734960406758,37.778352258769885],[-122.39043053586627,37.77714136218168],[-122.3850112558306,37.776334097789544],[-122.38692301351082,37.77432628635269],[-122.3818355261304,37.77460572402689],[-122.38147213417466,37.77190449317628],[-122.38676501700833,37.77327063291682],[-122.38485325932811,37.7671126545409],[-122.38662282015609,37.76389394651584],[-122.38117194081991,37.76014741177285],[-122.38080854886417,37.755200329985136],[-122.38407907646587,37.7549519409414],[-122.37995536775068,37.7520540687645],[-122.37608445343949,37.75225071009079],[-122.3757684604345,37.748711166217575],[-122.38812378692981,37.74779005684706],[-122.39303747815748,37.74847312671733],[-122.39049373446727,37.74669300523723],[-122.37622665029174,37.747148385150744],[-122.37278232653729,37.745492458192516],[-122.36763164055587,37.74013139466525],[-122.37401469925678,37.73948972296893],[-122.3726243300348,37.73827882638073],[-122.36750524335388,37.73833057409817],[-122.37308251989204,37.737036881162055],[-122.37553146568075,37.73835127318515],[-122.37559466428175,37.73272112152717],[-122.37222933877855,37.734190756702596],[-122.3686902171226,37.731965604852476],[-122.36511949616616,37.73206910028737],[-122.36191216716546,37.73008198793749],[-122.35696687663729,37.72870549865346],[-122.35800965355376,37.72603531643332],[-122.36164357311121,37.7252073529542],[-122.36382392484568,37.72209214036403],[-122.35924202627325,37.71940125905691],[-122.36273374897844,37.72007397938369],[-122.36263895107695,37.71802476977288],[-122.3655460867229,37.71597556016207],[-122.36772643845737,37.71764183666379],[-122.37390410170502,37.71883203416502],[-122.37707983140523,37.72423449586624],[-122.38098234501692,37.72178165405936],[-122.38692301351082,37.72415169951833],[-122.38273610619464,37.72171955679843],[-122.38319429605188,37.72008432892718],[-122.37616345169074,37.715934161988116],[-122.38012916390343,37.71123546924414],[-122.37943397929244,37.70841004387166],[-122.38591183589485,37.70997282493849],[-122.38804478867856,37.70867913200237],[-122.391489112433,37.70969338726429],[-122.39499663478846,37.70841004387166],[-122.4208606622473,37.70832724752375],[-122.45427692252555,37.70821340254537],[-122.45912741515222,37.70820305300188],[-122.47105615109079,37.70820305300188],[-122.50278184879231,37.7080892080235],[-122.50605237639401,37.71908042320875],[-122.50853292148322,37.73534990557336],[-122.5094177018972,37.74525441869227],[-122.51249863369591,37.76385254834189],[-122.51314641935616,37.77121107376252],[-122.5131622190064,37.775050754396915]],[[-122.40880552910674,37.79015073834727],[-122.40880552910674,37.790140388803785],[-122.40877392980624,37.79015073834727],[-122.40880552910674,37.79015073834727]]]},"properties":{"name":"SF"}};


var mapContainer = d3.select('#map-container');

var margin = {top: 10, left: 10, bottom: 10, right: 10},
    width = parseInt(mapContainer.style('width')),
    width = width - margin.left - margin.right,
    mapRatio = 1,
    height = width * mapRatio,
    scaleMultiplier = 350;

var svg = mapContainer.append('svg')

var projection = d3.geo.mercator()
    .center([ -122.441, 37.758 ])
    .scale(width*scaleMultiplier)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

svg.call(renderNeighborhood);

svg.attr('height', height)
   .attr('id','neighborhood-map');

svg.append('path')
   .datum(cityOutline)
   .attr('class', 'city-outline')
   .attr('d', path)


function renderNeighborhood(){
  svg.append('path')
        .datum(neighborhoodGeojson)
      .attr('class', 'neighborhood')
      .attr('d', path);

  svg.append('g')
      .attr('class', 'routes')
    .selectAll('.route')
      .data(routesInNeighborhoodGeojson)
    .enter().append('path')
      .attr('class', 'route')
      .on('mouseover', function(d) { return setTitle(d.properties.name); })
      .attr('d', path)
}

d3.select(window).on('resize', resize);

function resize() {
  // adjust things when the window size changes
  width = parseInt(mapContainer.style('width'));
  width = width - margin.left - margin.right;
  height = width * mapRatio;

  // update projection
  projection
      .translate([width / 2, height / 2])
      .scale(width*scaleMultiplier);

  // resize the map container
  svg
      .style('width', width + 'px')
      .style('height', height + 'px');

  // resize the map
  svg.select('.neighborhoods').attr('d', path);
  svg.selectAll('.neighborhood').attr('d', path);
}

function setTitle(newTitle){
  d3.select('#selected-route').text(newTitle);
  // var parsedName = newTitle.replace(/ /g,'').toLowerCase();
  // var infoCard = $('#' + parsedName);
  // var infoRoutes = infoCard.children().children('p').text()
  // var routeList = d3.select('#selected-title-routes')
  // routeList.text('Routes in this neighborhood: ' + infoRoutes);
  // (infoRoutes.length !== 0) ? routeList.classed('hidden', false) : routeList.classed('hidden', true);
}
